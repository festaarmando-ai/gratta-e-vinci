<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2299.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="it"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta charset="utf-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;title&gt;Gratta &amp; Vinci&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta name="description" content="Gratta e scopri la sorpresa!" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--bg1:#0f172a; --bg2:#111827;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--card:#0b1224; --text:#e5e7eb; --muted:#9ca3af;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--accent:#22c55e; --accent2:#f59e0b;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>body{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin:0; min-height:100vh; display:grid; place-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: radial-gradient(1200px 800px at 20% 10%, #1f2937 0%, var(--bg1) 40%, var(--bg2) 100%);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color:var(--text);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 24px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.wrap{width:min(560px, 100%);}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.badge{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:inline-flex; gap:10px; align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding:10px 14px; border:1px solid rgba(255,255,255,.12);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius:999px; background: rgba(255,255,255,.06);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:700; letter-spacing:.2px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.badge .dot{width:10px;height:10px;border-radius:50%; background: linear-gradient(135deg, var(--accent), #60a5fa);}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.card{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-top:14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:1px solid rgba(255,255,255,.12);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius:24px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding:18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 18px 50px rgba(0,0,0,.45);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:relative;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.title{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: clamp(22px, 3.6vw, 28px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin: 2px 0 6px 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:900;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.sub{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin:0 0 14px 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: var(--muted);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>line-height:1.35;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.scratch-area{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:relative;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius:18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: radial-gradient(800px 300px at 30% 20%, rgba(34,197,94,.25), rgba(245,158,11,.10) 55%, rgba(59,130,246,.12) 100%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>linear-gradient(180deg, rgba(2,6,23,.9), rgba(2,6,23,.65));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:1px solid rgba(255,255,255,.10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>aspect-ratio: 16 / 10;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>min-height: 220px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.prize{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute; inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:grid; place-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-align:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.prize h2{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: clamp(22px, 4.2vw, 34px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>line-height:1.05;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing:.4px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:1000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-shadow: 0 10px 30px rgba(0,0,0,.45);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.prize p{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin:10px 0 0 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: rgba(229,231,235,.88);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:700;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute; inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>width:100%; height:100%;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>touch-action:none; /* IMPORTANT per mobile */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:block;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hint{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-top:12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: var(--muted);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 13px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>button{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>appearance:none; border:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: rgba(255,255,255,.10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: var(--text);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 10px 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>cursor:pointer;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:1px solid rgba(255,255,255,.14);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>button:hover{ background: rgba(255,255,255,.14); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.done{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-top: 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 12px 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 16px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:1px solid rgba(34,197,94,.25);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: rgba(34,197,94,.10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: rgba(229,231,235,.95);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.done span{ color: var(--accent); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.footer{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-top: 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: rgba(156,163,175,.85);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-align:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="badge"&gt;&lt;span class="dot"&gt;&lt;/span&gt; Gratta &amp; Vinci virtuale&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="title"&gt;Gratta qui ğŸ&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;p class="sub"&gt;Trascina il dito (o il mouse) sullâ€™area argentata per scoprire il messaggio nascosto.&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="scratch-area" id="scratchBox"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="prize" aria-live="polite"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;h2 id="msg"&gt;SVETLANA HA VINTO UN MILIONE&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;p&gt;ğŸ„ Buone feste! ğŸ„&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;canvas id="scratch"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div&gt;Consiglio: gratta un poâ€™ in piÃ¹ per far apparire tutto.&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="resetBtn" type="button"&gt;Ricomincia&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="done" id="doneBox"&gt;âœ… Rivelato! &lt;span&gt;Auguri!&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="footer"&gt;Suggerimento: apri il link direttamente da WhatsApp.&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// ---- Config ----</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const REVEAL_THRESHOLD = 0.45; // 45% grattato = "completato"</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const COVER_TEXT = "GRATTA QUI";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const canvas = document.getElementById('scratch');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const box = document.getElementById('scratchBox');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const resetBtn = document.getElementById('resetBtn');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const doneBox = document.getElementById('doneBox');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const ctx = canvas.getContext('2d', { willReadFrequently: true });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let isDrawing = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let completed = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function resizeCanvas() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const rect = box.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dpr = Math.max(1, window.devicePixelRatio || 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.width = Math.floor(rect.width * dpr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.height = Math.floor(rect.height * dpr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.style.width = rect.width + 'px';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.style.height = rect.height + 'px';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.setTransform(dpr, 0, 0, dpr, 0, 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>drawCover();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>completed = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>doneBox.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drawCover() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const w = canvas.getBoundingClientRect().width;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const h = canvas.getBoundingClientRect().height;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Fondo "argentato"</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const grad = ctx.createLinearGradient(0, 0, w, h);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>grad.addColorStop(0, '#d1d5db');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>grad.addColorStop(0.35, '#9ca3af');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>grad.addColorStop(0.7, '#e5e7eb');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>grad.addColorStop(1, '#6b7280');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.globalCompositeOperation = 'source-over';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fillStyle = grad;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fillRect(0, 0, w, h);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Texture leggera</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.globalAlpha = 0.18;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i = 0; i &lt; 140; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillStyle = `rgba(0,0,0,${Math.random() * 0.25})`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillRect(Math.random() * w, Math.random() * h, 2 + Math.random() * 3, 2 + Math.random() * 3);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.globalAlpha = 1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Testo</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fillStyle = 'rgba(17,24,39,.9)';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.font = '900 22px system-ui, -apple-system, Segoe UI, Roboto, Arial';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.textAlign = 'center';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.textBaseline = 'middle';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fillText(COVER_TEXT, w / 2, h / 2);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Imposta modalitÃ  "gratta": cancelliamo col pennello</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.globalCompositeOperation = 'destination-out';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function getPoint(e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const touch = e.touches &amp;&amp; e.touches[0];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const clientX = touch ? touch.clientX : e.clientX;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const clientY = touch ? touch.clientY : e.clientY;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return { x: clientX - rect.left, y: clientY - rect.top };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function scratchAt(x, y) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (completed) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.arc(x, y, 22, 0, Math.PI * 2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function estimateRevealed() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Campionamento: calcola percentuale trasparente</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const w = Math.floor(rect.width);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const h = Math.floor(rect.height);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Riduci lavoro: leggi immagine scalata</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const sampleW = 220;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const sampleH = Math.floor(sampleW * (h / w));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const img = ctx.getImageData(0, 0, sampleW, sampleH).data;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let transparent = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const total = img.length / 4;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i = 0; i &lt; img.length; i += 4) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const alpha = img[i + 3];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (alpha &lt; 10) transparent++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return transparent / total;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function maybeComplete() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (completed) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const revealed = estimateRevealed();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (revealed &gt;= REVEAL_THRESHOLD) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>completed = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Rimuovi cover completamente</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.globalCompositeOperation = 'source-over';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.clearRect(0, 0, canvas.width, canvas.height);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.globalCompositeOperation = 'destination-out';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>doneBox.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function onDown(e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>isDrawing = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const p = getPoint(e);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>scratchAt(p.x, p.y);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function onMove(e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!isDrawing) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const p = getPoint(e);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>scratchAt(p.x, p.y);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Completa con un po' di debounce â€œgrezzoâ€</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!completed &amp;&amp; Math.random() &lt; 0.08) maybeComplete();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function onUp(e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!isDrawing) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>isDrawing = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>maybeComplete();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Eventi mouse + touch</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas.addEventListener('mousedown', onDown);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener('mousemove', onMove);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener('mouseup', onUp);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas.addEventListener('touchstart', onDown, { passive: false });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener('touchmove', onMove, { passive: false });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener('touchend', onUp, { passive: false });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>resetBtn.addEventListener('click', () =&gt; resizeCanvas());</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener('resize', () =&gt; resizeCanvas());</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Init</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>resizeCanvas();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
